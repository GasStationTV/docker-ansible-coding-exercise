# Sample docker app with HAproxy front end

## Overview/Usage

This example uses GCE and CentOS images. While terraform is out of scope, it is leveraged to provision/destroy nodes quickly and provides a dynamic inventory for ansible use.

Once you've created your [GCE api key](https://support.google.com/cloud/answer/6158862#service-accounts), you can drop it in the root directory and name it account.json, it will be consumed by terraform automatically. The gce.tf file is what terraform uses to define your nodes, then the inventory plugin is used for the terraform output. The gce.tf included will result in 3 nodes created.



#### Example workflow

```
terraform get
terraform plan
terraform apply
```

This will provision three nodes in your GCE project. From there, all we need to do is run the site.yml playbook. This will run through the roles, the recap should look like below.

```
ansible-playbook site.yml
...
...
PLAY RECAP *********************************************************************
gtv-docker-01              : ok=13   changed=9    unreachable=0    failed=0
gtv-docker-02              : ok=13   changed=9    unreachable=0    failed=0
gtv-haproxy-01             : ok=9    changed=6    unreachable=0    failed=0
```

From here, you should have a functioning stack, two docker nodes each running two docker containers that are added to the HAproxy node. You can run the below command, and curl/browse to your HAproxy node directly and get a cheesy response.

```
➜  docker-ansible-coding-exercise git:(master) ✗ plugins/inventory/terraform.py --hostfile
## begin hosts generated by terraform.py ##
104.196.2.150   	gtv-docker-01
104.196.44.70   	gtv-docker-02
104.196.36.96   	gtv-haproxy-01
## end hosts generated by terraform.py ##
```
